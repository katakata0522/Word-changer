<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å®Ÿç”¨ãƒã‚¿æ–‡å­—å¤‰æ›</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #f0f4f8; 
      color: #333;
      font-family: 'Noto Sans JP', 'Meiryo', sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .container {
      margin-top: 20px;
      margin-bottom: 20px;
      background: #fff;
      border-radius: 18px; 
      box-shadow: 0 8px 25px rgba(0,0,0,0.08); 
      padding: 1.5em 1.2em;
      width: 98vw;
      max-width: 550px; 
      min-width: 300px;
    }
    .app-title {
      font-size: 1.7em; 
      text-align: center;
      margin-bottom: 1em;
      font-weight: 700;
      letter-spacing: 1px;
      color: #2c669c; 
    }


    .main-category-tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 1.2em;
      border-bottom: 2px solid #e0e0e0;
    }
    .main-category-tab {
      padding: 0.6em 1.5em;
      font-size: 1.1em;
      font-weight: 600;
      color: #666;
      cursor: pointer;
      border: none;
      background: none;
      position: relative;
      transition: color 0.3s;
    }
    .main-category-tab.active {
      color: #2c669c;
    }
    .main-category-tab.active::after {
      content: '';
      position: absolute;
      bottom: -2px; 
      left: 0;
      width: 100%;
      height: 2px;
      background-color: #2c669c;
    }


    .conversion-tabs-panel {
      display: none; 
    }
    .conversion-tabs-panel.active {
      display: block;
    }
    .conversion-tabs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); 
      gap: 8px;
      justify-content: center;
      margin-bottom: 1em;
    }
    .sub-tab {
      padding: 0.5em 0.3em; 
      border-radius: 8px;
      background: #e9f1f8; 
      color: #334e68; 
      font-weight: 500;
      cursor: pointer;
      border: 1px solid #cddbea; 
      outline: none;
      font-size: 0.88em; 
      text-align: center;
      transition: background 0.2s, color 0.2s, border-color 0.2s;
      min-height: 40px; 
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .sub-tab.active {
      background: #3b82f6; 
      color: #fff;
      font-weight: bold;
      border-color: #3b82f6;
    }


    .input-area {
      width: 100%;
      margin-bottom: 1em;
      position: relative;
    }
    textarea {
      width: 100%;
      min-height: 100px;
      font-size: 1.05em;
      padding: 0.7em;
      border-radius: 10px; 
      border: 1.5px solid #c5d9e8; 
      resize: vertical;
      margin-bottom: 0.3em;
      box-sizing: border-box;
      background: #f9fbfd; 
      padding-right: 30px;
    }
    .input-clear-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 1.5em;
      color: #aaa;
      cursor: pointer;
      padding: 0;
      line-height: 1;
    }
    .input-clear-btn:hover { color: #777; }
    .char-counter {
      font-size: 0.8em;
      color: #777;
      text-align: right;
      padding-right: 5px;
    }
    .convert-btn {
      display: block;
      margin: 0.5em auto 1em auto; 
      background: #3b82f6; 
      color: #fff;
      border: none;
      padding: 0.7em 2em;
      border-radius: 30px;
      font-size: 1.05em;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 2px 10px rgba(59, 130, 246, 0.3); 
      transition: background 0.2s;
    }
    .convert-btn:hover { background: #2563eb; } 


    .result-area {
      background: #f9fbfd;
      border-radius: 10px;
      padding: 1em;
      margin-bottom: 0.7em;
      min-height: 50px;
      font-size: 1.1em;
      word-break: break-all;
      border: 1.5px solid #c5d9e8;
      position: relative;
      display: none;
      flex-direction: column;
      align-items: center;
    }
    #resultText { width: 100%; text-align: left; }
    .copy-btn {
      margin: 1em auto 0.2em auto;
      display: flex;
      align-items: center;
      gap: 0.5em;
      background: #fff;
      color: #3b82f6;
      border: 1px solid #3b82f6;
      border-radius: 9px;
      font-size: 0.95em;
      padding: 0.4em 1em;
      cursor: pointer;
      font-weight: 500;
      transition: background 0.2s, color 0.2s;
    }
    .copy-btn:active { background: #e0e7ff; } 
    .copy-btn .icon { font-size: 1.1em; }


    .footer {
      text-align: center;
      margin-top: 2em;
      font-size: 0.9em;
      color: #666; 
      opacity: 0.9;
      letter-spacing: 0.5px;
      line-height: 1.5;
    }
    @media (max-width: 600px) { 
      .container { max-width: 98vw; padding: 1em 3vw;}
      .app-title { font-size: 1.5em;}
      .main-category-tab { font-size: 1em; padding: 0.6em 1em;}
      .sub-tab { font-size: 0.85em; min-height: 36px; }
      .conversion-tabs-grid { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); } 
      textarea { font-size: 1em; }
      .convert-btn { font-size: 1em; }
      .result-area { font-size: 1em; }
    }
     @media (max-width: 400px) {
      .conversion-tabs-grid { grid-template-columns: repeat(auto-fill, minmax(85px, 1fr)); }
      .sub-tab { font-size: 0.8em; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="app-title">å®Ÿç”¨ãƒã‚¿æ–‡å­—å¤‰æ›</div>


    <div class="main-category-tabs">
      <button class="main-category-tab active" data-category="practical">å®Ÿç”¨</button>
      <button class="main-category-tab" data-category="fun">ãƒã‚¿</button>
    </div>


    <div id="practicalPanel" class="conversion-tabs-panel active">
      <div class="conversion-tabs-grid" id="practicalTabsContainer">
        <!-- å®Ÿç”¨ã‚¿ãƒ–ã¯JSã§ç”Ÿæˆ -->
      </div>
    </div>
    <div id="funPanel" class="conversion-tabs-panel">
      <div class="conversion-tabs-grid" id="funTabsContainer">
        <!-- ãƒã‚¿ã‚¿ãƒ–ã¯JSã§ç”Ÿæˆ -->
      </div>
    </div>


    <div class="input-area">
      <textarea id="inputText" maxlength="2000" placeholder="ã“ã“ã«å¤‰æ›ã—ãŸã„æ–‡ç« ã‚’å…¥åŠ›"></textarea>
      <button id="clearInputBtn" class="input-clear-btn" title="å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢">Ã—</button>
      <div id="charCounter" class="char-counter">0 / 2000</div>
    </div>


    <button class="convert-btn" id="convertBtn">å¤‰æ›ã™ã‚‹</button>


    <div class="result-area" id="resultArea">
      <span id="resultText"></span>
      <button class="copy-btn" id="copyBtn" style="display:none;">
        <span class="icon">ğŸ“‹</span><span class="text">ã‚³ãƒ”ãƒ¼</span>
      </button>
    </div>
  </div>


  <div class="footer">
    Â© 2025 ã‹ãŸã‹ãŸ All rights reserved.<br>
    â€»ã“ã®ã‚µã‚¤ãƒˆã¯ç¿»è¨³æ©Ÿã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>ãƒã‚¿å¤‰æ›ã§å¤‰æ›ã•ã‚ŒãŸè¨€è‘‰ã¯ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—ã§ã‚ã‚Šã€æ„å‘³ã‚’æˆã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
  </div>


<script>
  // --- Constants ---
  const APP_VERSION_PREFIX = 'jmn_v2_'; // ã‚¢ãƒ—ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹
  const LOCAL_STORAGE_MAIN_CATEGORY_KEY = `${APP_VERSION_PREFIX}mainCategory`;
  const LOCAL_STORAGE_SUB_TAB_KEY_PREFIX = `${APP_VERSION_PREFIX}subTab_`; // å¾Œã‚ã«ã‚«ãƒ†ã‚´ãƒªåã‚’ä»˜åŠ 


  // --- DOM Elements (Cached) ---
  const inputText = document.getElementById('inputText');
  const resultText = document.getElementById('resultText');
  const resultArea = document.getElementById('resultArea');
  const copyBtn = document.getElementById('copyBtn');
  const copyBtnText = copyBtn.querySelector('.text');
  const copyBtnIcon = copyBtn.querySelector('.icon');
  const convertBtn = document.getElementById('convertBtn');
  const clearInputBtn = document.getElementById('clearInputBtn');
  const charCounter = document.getElementById('charCounter');
  const mainCategoryTabs = document.querySelectorAll('.main-category-tab');
  const practicalPanel = document.getElementById('practicalPanel');
  const funPanel = document.getElementById('funPanel');
  const practicalTabsContainer = document.getElementById('practicalTabsContainer');
  const funTabsContainer = document.getElementById('funTabsContainer');


  // --- State ---
  let currentMainCategory = 'practical'; // Default main category
  let currentSubTab = '';             // Active sub-tab ID


  // --- Configuration Data ---
  const tabDefinitions = {
    practical: [
      { id: 'upper', label: 'å°â†’å¤§æ–‡å­—' },
      { id: 'lower', label: 'å¤§â†’å°æ–‡å­—' },
      { id: 'hiraToHalfKata', label: 'ã‹ãªâ†’åŠè§’ã‚«ãƒŠ' },
      { id: 'toHalfAlphaNum', label: 'å…¨è§’è‹±æ•°â†’åŠè§’' },
      { id: 'toFullAlphaNum', label: 'åŠè§’è‹±æ•°â†’å…¨è§’' },
      { id: 'toHalfKata', label: 'å…¨è§’ã‚«ãƒŠâ†’åŠè§’' },
      { id: 'toFullKata', label: 'åŠè§’ã‚«ãƒŠâ†’å…¨è§’' },
      { id: 'spaceRemoveAll', label: 'ã‚¹ãƒšãƒ¼ã‚¹å…¨å‰Šé™¤' }
    ],
    fun: [
      { id: 'arabic', label: 'ã‚¢ãƒ©ãƒ“ã‚¢èªé¢¨' },
      { id: 'korean', label: 'éŸ“å›½èªé¢¨' },
      { id: 'alien', label: 'å®‡å®™äººèªé¢¨' },
      { id: 'reverse', label: 'é€†ã•æ–‡å­—' },
      { id: 'dakuten', label: 'æ¿ç‚¹ã¾ã¿ã‚Œ' },
      { id: 'emphasizedStatement', label: 'ç™º è¨€ å¼· èª¿' }
    ]
  };


  const funnySymbols = {
    arabic: ['Ø§','Ø¢','Ø£','Ø¹','Ø¥','Ø¡','Ø¨','Øª','Ø«','Ø¬','Ø­','Ø®','Ø¯','Ø°','Ø±','Ø²','Ø³','Ø´','Øµ','Ø¶','Ø·','Ø¸','Øº','Ù','Ù‚','Ùƒ','Ù„','Ù…','Ù†','Ù‡','Ùˆ','ÙŠ'],
    korean: ['ì•„','ìµ','ìš°','ì—¥','ì˜¤','ì¹´','í‚¹','ì¿ ','ì¼€','ì½©','ì‚­','ì‹±','ìˆ­','ì„¸','ì†¡','íƒ€','íƒ•','ì¹˜','ì¹­','ì¸ ','í…Œ','í† ','ë‚˜','ë‹','ëˆ„','ë„¤','ë†','í•˜','í','í›„','í—¤','í˜¸','ë§ˆ','ë°','ë¬´','ë©”','ëª¨','ì•¼','ìœ ','ìš”','ë¼','ë¦­','ë£¨','ë ˆ','ë¡œ','ì™€','ì›Œ','ì€','ì‰','ê°€','ê¸°','êµ¬','ê²Œ','ê³ ','ì','ì§€','ì£¼','ì œ','ì¡°','ë‹¤','ë””','ë‘','ë°','ë„','ë°”','ë¹„','ë¶€','ë² ','ë³´','íŒŒ','í”¼','í‘¸','í˜','í¬','ã…‹','ã…Œ','ã„´','ã…‡','ã……','ã…'],
    alien: ['â˜…','â˜¯','â€»','â™¨','Â§','â™›','â—†','â—‡','â—','â—‰','å','â€ ','âˆ®','Î¨','âˆ‘','âˆ‡','â‰¡','âˆ´','âŒ˜','Â¤','âˆ','â˜€','â˜‚','â˜','â˜ƒ','â˜„','â˜¾','â˜½','âœª','âœ¿','å','âœ','âœ ']
  };


  const placeholderTexts = {
    upper: "ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã®å°æ–‡å­—ã‚’å…¥åŠ›",
    lower: "ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã®å¤§æ–‡å­—ã‚’å…¥åŠ›",
    hiraToHalfKata: "ã²ã‚‰ãŒãªã‚’å…¥åŠ›ï¼ˆåŠè§’ã‚«ã‚¿ã‚«ãƒŠã«ï¼‰",
    toHalfAlphaNum: "å…¨è§’ã®è‹±æ•°å­—ã‚’å…¥åŠ›",
    toFullAlphaNum: "åŠè§’ã®è‹±æ•°å­—ã‚’å…¥åŠ›",
    toHalfKata: "å…¨è§’ã®ã‚«ã‚¿ã‚«ãƒŠã‚’å…¥åŠ›",
    toFullKata: "åŠè§’ã®ã‚«ã‚¿ã‚«ãƒŠã‚’å…¥åŠ›",
    spaceRemoveAll: "ã‚¹ãƒšãƒ¼ã‚¹ã‚’å…¨ã¦å‰Šé™¤ã—ãŸã„æ–‡ç« ã‚’å…¥åŠ›",
    arabic: "å¤‰æ›ã—ãŸã„è¨€è‘‰ã‚’å…¥åŠ›ï¼ˆã‚¢ãƒ©ãƒ“ã‚¢èªé¢¨ã«ï¼‰",
    korean: "å¤‰æ›ã—ãŸã„è¨€è‘‰ã‚’å…¥åŠ›ï¼ˆéŸ“å›½èªé¢¨ã«ï¼‰",
    alien: "å¤‰æ›ã—ãŸã„è¨€è‘‰ã‚’å…¥åŠ›ï¼ˆå®‡å®™äººèªé¢¨ã«ï¼‰",
    reverse: "å¤‰æ›ã—ãŸã„è¨€è‘‰ã‚’å…¥åŠ›ï¼ˆé€†ã•ã«ã—ã¾ã™ï¼‰",
    dakuten: "å¤‰æ›ã—ãŸã„è¨€è‘‰ã‚’å…¥åŠ›ï¼ˆæ¿ç‚¹ã¾ã¿ã‚Œã«ï¼‰",
    emphasizedStatement: "å¼·èª¿ã—ãŸã„è¨€è‘‰ã‚’å…¥åŠ›ï¼ˆã‚¹ãƒšãƒ¼ã‚¹ã§åŒºåˆ‡ã‚Šã¾ã™ï¼‰",
    default: "ã“ã“ã«å¤‰æ›ã—ãŸã„æ–‡ç« ã‚’å…¥åŠ›"
  };


  // --- Conversion Character Maps (Refactored) ---
  const KANA_MAP_HIRA_TO_HALF = {
    'ã‚':'ï½±', 'ã„':'ï½²', 'ã†':'ï½³', 'ãˆ':'ï½´', 'ãŠ':'ï½µ', 'ã‹':'ï½¶', 'ã':'ï½·', 'ã':'ï½¸', 'ã‘':'ï½¹', 'ã“':'ï½º',
    'ã•':'ï½»', 'ã—':'ï½¼', 'ã™':'ï½½', 'ã›':'ï½¾', 'ã':'ï½¿', 'ãŸ':'ï¾€', 'ã¡':'ï¾', 'ã¤':'ï¾‚', 'ã¦':'ï¾ƒ', 'ã¨':'ï¾„',
    'ãª':'ï¾…', 'ã«':'ï¾†', 'ã¬':'ï¾‡', 'ã­':'ï¾ˆ', 'ã®':'ï¾‰', 'ã¯':'ï¾Š', 'ã²':'ï¾‹', 'ãµ':'ï¾Œ', 'ã¸':'ï¾', 'ã»':'ï¾',
    'ã¾':'ï¾', 'ã¿':'ï¾', 'ã‚€':'ï¾‘', 'ã‚':'ï¾’', 'ã‚‚':'ï¾“', 'ã‚„':'ï¾”', 'ã‚†':'ï¾•', 'ã‚ˆ':'ï¾–', 'ã‚‰':'ï¾—', 'ã‚Š':'ï¾˜',
    'ã‚‹':'ï¾™', 'ã‚Œ':'ï¾š', 'ã‚':'ï¾›', 'ã‚':'ï¾œ', 'ã‚’':'ï½¦', 'ã‚“':'ï¾', 'ãŒ':'ï½¶ï¾', 'ã':'ï½·ï¾', 'ã':'ï½¸ï¾', 'ã’':'ï½¹ï¾',
    'ã”':'ï½ºï¾', 'ã–':'ï½»ï¾', 'ã˜':'ï½¼ï¾', 'ãš':'ï½½ï¾', 'ãœ':'ï½¾ï¾', 'ã':'ï½¿ï¾', 'ã ':'ï¾€ï¾', 'ã¢':'ï¾ï¾', 'ã¥':'ï¾‚ï¾',
    'ã§':'ï¾ƒï¾', 'ã©':'ï¾„ï¾', 'ã°':'ï¾Šï¾', 'ã³':'ï¾‹ï¾', 'ã¶':'ï¾Œï¾', 'ã¹':'ï¾ï¾', 'ã¼':'ï¾ï¾', 'ã±':'ï¾Šï¾Ÿ', 'ã´':'ï¾‹ï¾Ÿ',
    'ã·':'ï¾Œï¾Ÿ', 'ãº':'ï¾ï¾Ÿ', 'ã½':'ï¾ï¾Ÿ', 'ã':'ï½§', 'ãƒ':'ï½¨', 'ã…':'ï½©', 'ã‡':'ï½ª', 'ã‰':'ï½«', 'ã£':'ï½¯', 'ã‚ƒ':'ï½¬',
    'ã‚…':'ï½­', 'ã‚‡':'ï½®', 'ã‚':'ãƒ®', 'ã‚”':'ï½³ï¾', 'ãƒ¼':'ï½°', 'ã€':'ï½¤', 'ã€‚':'ï½¡'
  };
  const KANA_MAP_FULL_TO_HALF = {
    'ã‚¬':'ï½¶ï¾', 'ã‚®':'ï½·ï¾', 'ã‚°':'ï½¸ï¾', 'ã‚²':'ï½¹ï¾', 'ã‚´':'ï½ºï¾', 'ã‚¶':'ï½»ï¾', 'ã‚¸':'ï½¼ï¾', 'ã‚º':'ï½½ï¾', 'ã‚¼':'ï½¾ï¾', 'ã‚¾':'ï½¿ï¾',
    'ãƒ€':'ï¾€ï¾', 'ãƒ‚':'ï¾ï¾', 'ãƒ…':'ï¾‚ï¾', 'ãƒ‡':'ï¾ƒï¾', 'ãƒ‰':'ï¾„ï¾', 'ãƒ':'ï¾Šï¾', 'ãƒ“':'ï¾‹ï¾', 'ãƒ–':'ï¾Œï¾', 'ãƒ™':'ï¾ï¾', 'ãƒœ':'ï¾ï¾',
    'ãƒ‘':'ï¾Šï¾Ÿ', 'ãƒ”':'ï¾‹ï¾Ÿ', 'ãƒ—':'ï¾Œï¾Ÿ', 'ãƒš':'ï¾ï¾Ÿ', 'ãƒ':'ï¾ï¾Ÿ', 'ãƒ´':'ï½³ï¾', 'ãƒ·':'ï¾œï¾', 'ãƒº':'ï½¦ï¾', 'ã‚¢':'ï½±', 'ã‚¤':'ï½²',
    'ã‚¦':'ï½³', 'ã‚¨':'ï½´', 'ã‚ª':'ï½µ', 'ã‚«':'ï½¶', 'ã‚­':'ï½·', 'ã‚¯':'ï½¸', 'ã‚±':'ï½¹', 'ã‚³':'ï½º', 'ã‚µ':'ï½»', 'ã‚·':'ï½¼', 'ã‚¹':'ï½½',
    'ã‚»':'ï½¾', 'ã‚½':'ï½¿', 'ã‚¿':'ï¾€', 'ãƒ':'ï¾', 'ãƒ„':'ï¾‚', 'ãƒ†':'ï¾ƒ', 'ãƒˆ':'ï¾„', 'ãƒŠ':'ï¾…', 'ãƒ‹':'ï¾†', 'ãƒŒ':'ï¾‡', 'ãƒ':'ï¾ˆ',
    'ãƒ':'ï¾‰', 'ãƒ':'ï¾Š', 'ãƒ’':'ï¾‹', 'ãƒ•':'ï¾Œ', 'ãƒ˜':'ï¾', 'ãƒ›':'ï¾', 'ãƒ':'ï¾', 'ãƒŸ':'ï¾', 'ãƒ ':'ï¾‘', 'ãƒ¡':'ï¾’', 'ãƒ¢':'ï¾“',
    'ãƒ¤':'ï¾”', 'ãƒ¦':'ï¾•', 'ãƒ¨':'ï¾–', 'ãƒ©':'ï¾—', 'ãƒª':'ï¾˜', 'ãƒ«':'ï¾™', 'ãƒ¬':'ï¾š', 'ãƒ­':'ï¾›', 'ãƒ¯':'ï¾œ', 'ãƒ²':'ï½¦', 'ãƒ³':'ï¾',
    'ã‚¡':'ï½§', 'ã‚£':'ï½¨', 'ã‚¥':'ï½©', 'ã‚§':'ï½ª', 'ã‚©':'ï½«', 'ãƒƒ':'ï½¯', 'ãƒ£':'ï½¬', 'ãƒ¥':'ï½­', 'ãƒ§':'ï½®', 'ã€‚':'ï½¡', 'ã€':'ï½¤',
    'ãƒ¼':'ï½°', 'ã€Œ':'ï½¢', 'ã€':'ï½£', 'ãƒ»':'ï½¥'
  };
  const KANA_MAP_HALF_TO_FULL = {
    'ï½¶ï¾':'ã‚¬', 'ï½·ï¾':'ã‚®', 'ï½¸ï¾':'ã‚°', 'ï½¹ï¾':'ã‚²', 'ï½ºï¾':'ã‚´', 'ï½»ï¾':'ã‚¶', 'ï½¼ï¾':'ã‚¸', 'ï½½ï¾':'ã‚º', 'ï½¾ï¾':'ã‚¼', 'ï½¿ï¾':'ã‚¾',
    'ï¾€ï¾':'ãƒ€', 'ï¾ï¾':'ãƒ‚', 'ï¾‚ï¾':'ãƒ…', 'ï¾ƒï¾':'ãƒ‡', 'ï¾„ï¾':'ãƒ‰', 'ï¾Šï¾':'ãƒ', 'ï¾‹ï¾':'ãƒ“', 'ï¾Œï¾':'ãƒ–', 'ï¾ï¾':'ãƒ™', 'ï¾ï¾':'ãƒœ',
    'ï¾Šï¾Ÿ':'ãƒ‘', 'ï¾‹ï¾Ÿ':'ãƒ”', 'ï¾Œï¾Ÿ':'ãƒ—', 'ï¾ï¾Ÿ':'ãƒš', 'ï¾ï¾Ÿ':'ãƒ', 'ï½³ï¾':'ãƒ´', 'ï¾œï¾':'ãƒ·', 'ï½¦ï¾':'ãƒº', 'ï½±':'ã‚¢', 'ï½²':'ã‚¤',
    'ï½³':'ã‚¦', 'ï½´':'ã‚¨', 'ï½µ':'ã‚ª', 'ï½¶':'ã‚«', 'ï½·':'ã‚­', 'ï½¸':'ã‚¯', 'ï½¹':'ã‚±', 'ï½º':'ã‚³', 'ï½»':'ã‚µ', 'ï½¼':'ã‚·', 'ï½½':'ã‚¹',
    'ï½¾':'ã‚»', 'ï½¿':'ã‚½', 'ï¾€':'ã‚¿', 'ï¾':'ãƒ', 'ï¾‚':'ãƒ„', 'ï¾ƒ':'ãƒ†', 'ï¾„':'ãƒˆ', 'ï¾…':'ãƒŠ', 'ï¾†':'ãƒ‹', 'ï¾‡':'ãƒŒ', 'ï¾ˆ':'ãƒ',
    'ï¾‰':'ãƒ', 'ï¾Š':'ãƒ', 'ï¾‹':'ãƒ’', 'ï¾Œ':'ãƒ•', 'ï¾':'ãƒ˜', 'ï¾':'ãƒ›', 'ï¾':'ãƒ', 'ï¾':'ãƒŸ', 'ï¾‘':'ãƒ ', 'ï¾’':'ãƒ¡', 'ï¾“':'ãƒ¢',
    'ï¾”':'ãƒ¤', 'ï¾•':'ãƒ¦', 'ï¾–':'ãƒ¨', 'ï¾—':'ãƒ©', 'ï¾˜':'ãƒª', 'ï¾™':'ãƒ«', 'ï¾š':'ãƒ¬', 'ï¾›':'ãƒ­', 'ï¾œ':'ãƒ¯', 'ï½¦':'ãƒ²', 'ï¾':'ãƒ³',
    'ï½§':'ã‚¡', 'ï½¨':'ã‚£', 'ï½©':'ã‚¥', 'ï½ª':'ã‚§', 'ï½«':'ã‚©', 'ï½¯':'ãƒƒ', 'ï½¬':'ãƒ£', 'ï½­':'ãƒ¥', 'ï½®':'ãƒ§', 'ï½¡':'ã€‚', 'ï½¤':'ã€',
    'ï½°':'ãƒ¼', 'ï½¢':'ã€Œ', 'ï½£':'ã€', 'ï½¥':'ãƒ»'
  };




  // --- Conversion Functions ---
  function hiraToHalfKatakana(str) {
    return str.split('').map(char => KANA_MAP_HIRA_TO_HALF[char] || char).join('');
  }


  function toHalfWidthAlphaNum(str) {
    return str.replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0));
  }


  function toFullWidthAlphaNum(str) {
    return str.replace(/[A-Za-z0-9]/g, s => String.fromCharCode(s.charCodeAt(0) + 0xFEE0));
  }
  
  function toHalfWidthKatakana(str) {
    // å…¨è§’ã‚«ã‚¿ã‚«ãƒŠâ†’åŠè§’ã‚«ã‚¿ã‚«ãƒŠ (æ¿ç‚¹ãƒ»åŠæ¿ç‚¹ä»˜ãæ–‡å­—ã‚‚è€ƒæ…®)
    // 2æ–‡å­—ã§è¡¨ç¾ã•ã‚Œã‚‹åŠè§’æ–‡å­—(ä¾‹: ãƒ· -> ï¾œï¾)ã¯ KANA_MAP_FULL_TO_HALF ã«ç›´æ¥å®šç¾©ã•ã‚Œã¦ã„ã‚Œã°ãã‚Œã‚’ä½¿ç”¨
    // ãã†ã§ãªã‘ã‚Œã°1æ–‡å­—ãšã¤å¤‰æ›
    let halfwidth = '';
    for (let i = 0; i < str.length; i++) {
      const char = str[i];
      const nextChar = (i + 1 < str.length) ? str[i+1] : '';
      // 2æ–‡å­—ã®å…¨è§’ã‚«ã‚¿ã‚«ãƒŠã§ã€å¯¾å¿œã™ã‚‹åŠè§’ã‚«ã‚¿ã‚«ãƒŠãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹å ´åˆ (ä¾‹: "ãƒ´ã‚£" ã®ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã¯ã“ã“ã§ã¯æœªå¯¾å¿œ)
      // åŸºæœ¬çš„ã«ã¯1æ–‡å­—ãšã¤ã®å¤‰æ›ã§å¯¾å¿œ
      halfwidth += KANA_MAP_FULL_TO_HALF[char] || char;
    }
    return halfwidth;
  }


  function toFullWidthKatakana(str) {
    // åŠè§’ã‚«ã‚¿ã‚«ãƒŠâ†’å…¨è§’ã‚«ã‚¿ã‚«ãƒŠ (æ¿ç‚¹ãƒ»åŠæ¿ç‚¹ã‚‚çµåˆã—ã¦å¤‰æ›)
    let fullwidth = '';
    for (let i = 0; i < str.length; i++) {
      const char = str[i];
      const nextChar = (i + 1 < str.length) ? str[i+1] : '';
      // åŠè§’ã®æ¿ç‚¹ãƒ»åŠæ¿ç‚¹ï¼ˆä¾‹: ï½¶ + ï¾ â†’ ã‚¬ï¼‰ã‚’è€ƒæ…®
      if (nextChar && (nextChar === 'ï¾' || nextChar === 'ï¾Ÿ')) {
        const combined = char + nextChar;
        if (KANA_MAP_HALF_TO_FULL[combined]) {
          fullwidth += KANA_MAP_HALF_TO_FULL[combined];
          i++; // 2æ–‡å­—æ¶ˆè²»
          continue;
        }
      }
      fullwidth += KANA_MAP_HALF_TO_FULL[char] || char;
    }
    return fullwidth;
  }


  function removeAllSpaces(str) {
    return str.replace(/\s/g, '');
  }


  function randomConvert(str, symbolList) {
    return str.split('').map(ch => {
      if (/\s/.test(ch)) return ch; // Keep spaces
      return symbolList[Math.floor(Math.random() * symbolList.length)];
    }).join('');
  }


  function reverseString(str) {
    return str.split('').reverse().join('');
  }



  function addDakutenOnly(str) {
    // æ¿ç‚¹ã‚’ã¤ã‘ãªã„æ–‡å­—: ç©ºç™½ã€å¥èª­ç‚¹ãƒ»ä¸€éƒ¨è¨˜å·ã€ã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠä»¥å¤–ã®æ–‡å­—ã€
    // å°æ›¸ãæ–‡å­—ã€ã‚“ã€ãƒ´ã€ãƒµã€ãƒ¶ã€æ—¢ã«æ¿ç‚¹ãŒä»˜ã„ã¦ã„ã‚‹æ–‡å­—
    const NO_DAKUTEN_CHARS_REGEX = /[\sã€ã€‚ã€Œã€ï¼ï¼Ÿ()ï¼ˆï¼‰ãƒ¶ãƒµãƒ´ãƒ³ã‚“]/;
    const SMALL_KANA_REGEX = /[ããƒã…ã‡ã‰ã‚ƒã‚…ã‚‡ã‚ã£ã‚¡ã‚£ã‚¥ã‚§ã‚©ãƒ£ãƒ¥ãƒ§ãƒ®ãƒƒ]/;
    const KANA_REGEX = /[\u3040-\u309F\u30A0-\u30FF]/; // Hiragana & Katakana range
    const ALREADY_DAKUTEN_REGEX = /[ãŒããã’ã”ã–ã˜ãšãœãã ã¢ã¥ã§ã©ã°ã³ã¶ã¹ã¼ã±ã´ã·ãºã½ãƒ´ãƒ·ãƒºã‚¬ã‚®ã‚°ã‚²ã‚´ã‚¶ã‚¸ã‚ºã‚¼ã‚¾ãƒ€ãƒ‚ãƒ…ãƒ‡ãƒ‰ãƒãƒ“ãƒ–ãƒ™ãƒœãƒ‘ãƒ”ãƒ—ãƒšãƒ]/;

    let result = '';
    for (let i = 0; i < str.length; i++) {
      const ch = str[i];
      const nextChar = str[i + 1];
      if (NO_DAKUTEN_CHARS_REGEX.test(ch) ||
          SMALL_KANA_REGEX.test(ch) ||
          !KANA_REGEX.test(ch) ||
          ALREADY_DAKUTEN_REGEX.test(ch) ||
          nextChar === 'ã‚›' || nextChar === 'ã‚œ') {
        result += ch;
        continue;
      }
      result += ch + 'ã‚›';
    }
    return result;
  }
  function emphasizedStatementConversion(str) {
    if (str === null || str === undefined) {
      return '';
    }
    return str.split('').join(' ');
  }

  const conversionStrategies = {
    'upper': (text) => text.toUpperCase(),
    'lower': (text) => text.toLowerCase(),
    'hiraToHalfKata': hiraToHalfKatakana,
    'toHalfAlphaNum': toHalfWidthAlphaNum,
    'toFullAlphaNum': toFullWidthAlphaNum,
    'toHalfKata': toHalfWidthKatakana,
    'toFullKata': toFullWidthKatakana,
    'spaceRemoveAll': removeAllSpaces,
    'arabic': (text) => randomConvert(text, funnySymbols.arabic),
    'korean': (text) => randomConvert(text, funnySymbols.korean),
    'alien': (text) => randomConvert(text, funnySymbols.alien),
    'reverse': reverseString,
    'dakuten': addDakutenOnly,
    'emphasizedStatement': emphasizedStatementConversion,
  };


  // --- UI Update Functions ---
  function updatePlaceholder() {
    inputText.placeholder = placeholderTexts[currentSubTab] || placeholderTexts.default;
  }


  function updateCharCounter() {
    const currentLength = inputText.value.length;
    const maxLength = inputText.maxLength;
    charCounter.textContent = `${currentLength} / ${maxLength}`;
  }


  function resetResultArea() {
    resultArea.style.display = 'none';
    resultText.textContent = '';
    copyBtn.style.display = 'none';
  }


  // --- Tab Handling ---
  function createSubTabs(category, container) {
    container.innerHTML = ''; // Clear existing tabs before creation
    tabDefinitions[category].forEach(tabDef => {
      const button = document.createElement('button');
      button.classList.add('sub-tab');
      button.setAttribute('data-tab-id', tabDef.id);
      button.textContent = tabDef.label;
      button.addEventListener('click', () => { // Use arrow function for `this` lexical scoping if needed, though not here.
        setActiveSubTab(category, tabDef.id);
        resetResultArea();
      });
      container.appendChild(button);
    });
  }


  function setActiveMainCategory(category) {
    currentMainCategory = category;
    mainCategoryTabs.forEach(tab => {
      tab.classList.toggle('active', tab.dataset.category === category);
    });
    practicalPanel.classList.toggle('active', category === 'practical');
    funPanel.classList.toggle('active', category === 'fun');
    
    const savedSubTab = localStorage.getItem(LOCAL_STORAGE_SUB_TAB_KEY_PREFIX + category);
    const subTabsForCategory = tabDefinitions[category];


    if (savedSubTab && subTabsForCategory.some(t => t.id === savedSubTab)) {
      setActiveSubTab(category, savedSubTab);
    } else if (subTabsForCategory.length > 0) {
      // Default to the first sub-tab of the category if no saved tab or invalid saved tab
      setActiveSubTab(category, subTabsForCategory[0].id);
    } else {
      currentSubTab = ''; // No sub-tabs in this category
      updatePlaceholder(); // Update placeholder to default if no sub-tab
    }
    localStorage.setItem(LOCAL_STORAGE_MAIN_CATEGORY_KEY, category);
  }


  function setActiveSubTab(category, tabId) {
    // Ensure this function is only effective for the current main category's sub-tabs
    if (currentMainCategory !== category) return; 


    currentSubTab = tabId;
    const container = (category === 'practical') ? practicalTabsContainer : funTabsContainer;
    container.querySelectorAll('.sub-tab').forEach(tab => {
      tab.classList.toggle('active', tab.dataset.tabId === tabId);
    });
    updatePlaceholder();
    localStorage.setItem(LOCAL_STORAGE_SUB_TAB_KEY_PREFIX + category, tabId);
  }


  // --- Event Listeners ---
  mainCategoryTabs.forEach(tab => {
    tab.addEventListener('click', function() { // `this` refers to the clicked tab
      setActiveMainCategory(this.dataset.category);
    });
  });


  convertBtn.addEventListener('click', () => {
    const input = inputText.value;
    // Allow empty input for 'spaceRemoveAll' as it might be intentional
    if (input.trim() === '' && currentSubTab !== 'spaceRemoveAll') {
      resultText.textContent = 'ä½•ã‹å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
      resultArea.style.display = 'flex';
      copyBtn.style.display = 'none';
      return;
    }
    
    const selectedConversion = conversionStrategies[currentSubTab];
    let resultString = '';


    if (selectedConversion) {
      resultString = selectedConversion(input);
    } else {
      resultString = 'å¤‰æ›ã‚¿ã‚¤ãƒ—ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚';
    }


    resultText.textContent = resultString;
    resultArea.style.display = 'flex';


    // Show copy button only if there's a valid result (including empty string from spaceRemoveAll)
    if (resultString !== 'ä½•ã‹å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚' && resultString !== 'å¤‰æ›ã‚¿ã‚¤ãƒ—ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“.') {
      copyBtn.style.display = 'flex';
      copyBtnText.textContent = 'ã‚³ãƒ”ãƒ¼';
      copyBtnIcon.textContent = 'ğŸ“‹';
    } else {
      copyBtn.style.display = 'none';
    }
  });


  copyBtn.addEventListener('click', () => { 
    const textToCopy = resultText.textContent;
    // Allow copying empty string
    if (textToCopy === null || typeof textToCopy === 'undefined') return;


    if (navigator.clipboard && navigator.clipboard.writeText) { // Check for writeText availability
      navigator.clipboard.writeText(textToCopy)
        .then(() => {
          copyBtnText.textContent = "ã‚³ãƒ”ãƒ¼å®Œäº†ï¼"; copyBtnIcon.textContent = 'âœ…';
          setTimeout(() => { copyBtnText.textContent = "ã‚³ãƒ”ãƒ¼"; copyBtnIcon.textContent = 'ğŸ“‹'; }, 1500);
        })
        .catch(() => fallbackCopyTextToClipboard(textToCopy)); // Fallback on error
    } else {
      fallbackCopyTextToClipboard(textToCopy);
    }
  });


  function fallbackCopyTextToClipboard(text) { 
    const textArea = document.createElement("textarea");
    textArea.value = text;
    // Make the textarea non-visible and non-disruptive
    textArea.style.position = "fixed";
    textArea.style.top = "-9999px";
    textArea.style.left = "-9999px";
    document.body.appendChild(textArea);
    textArea.focus(); 
    textArea.select();
    try {
      const successful = document.execCommand('copy');
      if (successful) { 
        copyBtnText.textContent = "ã‚³ãƒ”ãƒ¼å®Œäº†ï¼"; copyBtnIcon.textContent = 'âœ…'; 
      } else { 
        copyBtnText.textContent = "ã‚³ãƒ”ãƒ¼å¤±æ•—"; copyBtnIcon.textContent = 'âŒ'; 
      }
    } catch (err) { 
      copyBtnText.textContent = "ã‚³ãƒ”ãƒ¼å¤±æ•—"; copyBtnIcon.textContent = 'âŒ'; 
    }
    document.body.removeChild(textArea);
    setTimeout(() => { 
      copyBtnText.textContent = "ã‚³ãƒ”ãƒ¼"; 
      copyBtnIcon.textContent = 'ğŸ“‹'; 
    }, 1500);
  }


  clearInputBtn.addEventListener('click', () => { 
    inputText.value = '';
    updateCharCounter();
    inputText.focus();
    resetResultArea();
  });


  inputText.addEventListener('input', updateCharCounter);


  // --- Initialization ---
  function initializeApp() {
    createSubTabs('practical', practicalTabsContainer);
    createSubTabs('fun', funTabsContainer);


    const savedMainCategory = localStorage.getItem(LOCAL_STORAGE_MAIN_CATEGORY_KEY);
    // Default to 'practical' if no saved category or invalid value
    setActiveMainCategory((savedMainCategory === 'practical' || savedMainCategory === 'fun') ? savedMainCategory : 'practical');
    
    updateCharCounter(); // Initialize character counter
  }


  // Start the application
  initializeApp();
</script>
</body>
</html>
